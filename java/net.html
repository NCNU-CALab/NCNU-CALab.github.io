<!DOCTYPE html>
<html lang="zh">
  <head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">

    <title>SSYU 的書們 | NET </title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    

    <!-- fonts -->
    <link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700" rel="stylesheet">
    <link href="//fonts.googleapis.com/css?family=Ubuntu:300,400,500,600,700" rel="stylesheet">

    <!-- stylesheets -->
    <link rel="stylesheet" href="/style/doc.css">

    <!-- favicon -->
    <link rel="icon" href="/images/favicon.ico"><!-- hexo-inject:begin --><!-- hexo-inject:end -->

    

  </head>
  <body>

   <!-- hexo-inject:begin --><!-- hexo-inject:end --><script>window.__INITIAL_STATE__ = {"page":{"title":"NET","path":"java/net.html"},"data":{"navigation":{"logo":{"text":"Programming Yu","type":"link","path":"index.html"},"main":[{"text":"C 程式語言教學","type":"label","children":[{"text":"程式寫作概論","type":"link","path":"c/writing-intro.html"},{"text":"電腦系統概論","type":"link","path":"c/system-intro.html"},{"text":"電腦內部運作","type":"link","path":"c/system-operation.html"},{"text":"C 語言的總覽","type":"link","path":"c/c-intro.html"}]},{"text":"C 程式語言範例","type":"label","children":[{}]},{"text":"Java 程式語言教學","type":"label","children":[{"text":"Java 與 C 的比較","type":"link","path":"java/java-vs-c.html"},{"text":"類別與物件","type":"link","path":"java/class-and-obj.html"},{"text":"陣列","type":"link","path":"java/array.html"},{"text":"封裝","type":"link","path":"java/encapsulation.html"},{"text":"訊息傳遞","type":"link","path":"java/message-passing.html"},{"text":"繼承","type":"link","path":"java/extends.html"},{"text":"介面","type":"link","path":"java/interface.html"},{"text":"例外處理","type":"link","path":"java/exception.html"},{"text":"線串與同步處理","type":"link","path":"java/thread.html"},{"text":"容器類別","type":"link","path":"java/container.html"},{"text":"GUI","type":"link","path":"java/gui.html"},{"text":"IO","type":"link","path":"java/io.html"},{"text":"NET","type":"link","path":"java/net.html"},{"text":"JDBC","type":"link","path":"java/jdbc.html"},{"text":"印表","type":"link","path":"java/easy-print.html"}]},{"text":"Java 程式語言範例","type":"label","children":[{"text":"所得稅計算","type":"link","path":"java/examples/tax-calculate.html"}]},{"text":"資料結構與演算法","type":"label"}]},"posts":[{"text":"The 3n + 1 problem","type":"link","path":"questions/The-3n-1-problem/","date":"2017-12-21T19:53:25+00:00"}]},"config":{"timezone":"Asia/Taipei","root":"/","time_format":"HH:mm:ss","theme":"doc","theme_config":{"swagger_ui":{"version":2,"permalinks":true,"api_explorer":true,"download":"Download specification","show_extensions":false,"deep_linking":true,"display_operation_id":false,"doc_expansion":"none"},"search":{"skip":false,"background":false,"route":"/lunr.json"},"favicon":"images/favicon.ico"}}}</script>

    <div id="react-navigation-root"><div class="doc-navigation" data-reactroot=""><nav class="doc-navbar"><a href="/index.html" class="doc-navbar__logo"><img src="/images/logo.png" class="doc-navbar__logo__img"/><span class="doc-navbar__logo__text">Programming Yu</span></a><i class="dc-icon dc-icon--close dc-icon--interactive doc-sidebar-close doc-navbar__sidebar-close doc-navbar__sidebar-close--desktop"></i><i class="dc-icon dc-icon--menu dc-icon--interactive doc-sidebar-toggle doc-navbar__sidebar-toggle"></i></nav><nav class="doc-sidebar"><div class="doc-sidebar__vertical-menu"><i class="dc-icon dc-icon--menu dc-icon--interactive doc-sidebar-toggle doc-sidebar-toggle--primary doc-sidebar__vertical-menu__item"></i><i class="dc-icon dc-icon--search dc-icon--interactive doc-sidebar__vertical-menu__item doc-sidebar__vertical-menu__item--primary"></i></div><div class="doc-sidebar-content"><div class="doc-sidebar__search-form"></div><ul class="doc-sidebar-list"></ul></div></nav></div></div>
    <div class="doc-content">
  <div class="dc-page">
    <div class="dc-card">
      <div id="react-search-results-root"></div>
      <div id="page-content" class="doc-formatting">
        <h1>NET</h1>
        <h2 id="SMTP-Client"><a href="#SMTP-Client" class="headerlink" title="SMTP Client"></a>SMTP Client</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Program Name: SMTP.java</span></span><br><span class="line"><span class="comment">   Subject: 寄信程式 </span></span><br><span class="line"><span class="comment">   Editor: 俞旭昇 Shiuh-Sheng Yu</span></span><br><span class="line"><span class="comment">           National ChiNan University</span></span><br><span class="line"><span class="comment">           Department of Information Management</span></span><br><span class="line"><span class="comment">   Edit Date: 04/24/2000</span></span><br><span class="line"><span class="comment">   Last Update Date: 04/24/2000</span></span><br><span class="line"><span class="comment">   Modify Date: 2004/09/21, 加入mime content type</span></span><br><span class="line"><span class="comment">   Modify Date: 2005/09/16, 改用UTF-8來傳送資料</span></span><br><span class="line"><span class="comment">   Modify Date: 2005/09/22, 改回用big5 :(</span></span><br><span class="line"><span class="comment">   Modify Date: 2006/02/16, 失敗改retry, 利用queue來smooth需求量</span></span><br><span class="line"><span class="comment">   ToolKit: JDK1.1</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">package</span> ncnu.net;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"><span class="keyword">import</span> ncnu.rule.Environment;</span><br><span class="line"><span class="keyword">import</span> ncnu.gui.SpeedBar;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Request</span> </span>&#123;</span><br><span class="line">    String sender;</span><br><span class="line">    String[] receiver;</span><br><span class="line">    String subject;</span><br><span class="line">    String[] data;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Queue</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Request[] data;</span><br><span class="line">    <span class="keyword">int</span> size;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> head;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> tail;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Queue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        size = head = tail = <span class="number">0</span>;</span><br><span class="line">        data = <span class="keyword">new</span> Request[<span class="number">3000</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> Request <span class="title">deQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (size==<span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span>(Exception ex) &#123;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        Request tmp = data[head];</span><br><span class="line">        data[head] = <span class="keyword">null</span>;</span><br><span class="line">        head = (head+<span class="number">1</span>)%data.length;</span><br><span class="line">        size--;</span><br><span class="line">        <span class="keyword">if</span> (size==data.length-<span class="number">1</span>) &#123;</span><br><span class="line">            notifyAll();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> tmp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">enQueue</span><span class="params">(Request c)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (size==data.length) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span>(Exception ex) &#123;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        data[tail++] = c;</span><br><span class="line">        tail %= data.length;</span><br><span class="line">        size++;</span><br><span class="line">        <span class="keyword">if</span> (size==<span class="number">1</span>) &#123;</span><br><span class="line">            notifyAll();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isFull</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size == data.length;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SMTP</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Queue queue = <span class="keyword">new</span> Queue();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> nowHave;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">showProgress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SpeedBar sb = <span class="keyword">new</span> SpeedBar(<span class="string">"待送郵件數目"</span>);</span><br><span class="line">        <span class="keyword">while</span> (queue.size &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            sb.setSpeed(queue.size,<span class="string">"待送郵件數目:"</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.currentThread().sleep(<span class="number">3000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception epp) &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        sb.dispose();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Send email to a group of users. The method will be called by all mail fuctions</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sender Mail sender's email account</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> resceiver Array of receivers' email account</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> subject email subject</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data An array of String which constructs the content of the email</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(String sender,String[] receiver,String subject,String[] data)</span> </span>&#123;</span><br><span class="line">        Request req = <span class="keyword">new</span> Request();</span><br><span class="line">        req.sender = sender;</span><br><span class="line">        req.receiver = receiver;</span><br><span class="line">        req.subject = subject;</span><br><span class="line">        req.data = data;</span><br><span class="line">        queue.enQueue(req);</span><br><span class="line">        <span class="keyword">while</span> (nowHave&lt;<span class="number">5</span>) &#123;</span><br><span class="line">            (<span class="keyword">new</span> SMTP()).start();</span><br><span class="line">            nowHave++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            Request tmp = queue.deQueue();</span><br><span class="line">            String sender = tmp.sender;</span><br><span class="line">            String[] receiver = tmp.receiver;</span><br><span class="line">            String subject = tmp.subject;</span><br><span class="line">            String[] data = tmp.data;</span><br><span class="line">            <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Socket smtps = <span class="keyword">new</span> Socket(Environment.getMailServer(),<span class="number">25</span>);</span><br><span class="line">                    PrintStream smtpsOutput = <span class="keyword">new</span> PrintStream(smtps.getOutputStream());</span><br><span class="line">                    BufferedReader smtpsInput = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(smtps.getInputStream()));</span><br><span class="line">                    smtpsInput.readLine();</span><br><span class="line">                    smtpsOutput.println(<span class="string">"HELO "</span>+Environment.getDomain());</span><br><span class="line">                    smtpsOutput.flush();</span><br><span class="line">                    smtpsInput.readLine();</span><br><span class="line">                    smtpsOutput.println(<span class="string">"MAIL FROM:"</span>+sender);  <span class="comment">// 寄 信 人 </span></span><br><span class="line">                    smtpsOutput.flush();</span><br><span class="line">                    smtpsInput.readLine();</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i<span class="string">");</span></span><br><span class="line"><span class="string">                    smtpsOutput.flush();</span></span><br><span class="line"><span class="string">                    smtpsOutput.print("</span>To: <span class="string">");</span></span><br><span class="line"><span class="string">                    for (int i=0; i"</span>); <span class="comment">// 收 信 人</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    smtpsOutput.println(<span class="string">""</span>);</span><br><span class="line">                    smtpsOutput.flush();</span><br><span class="line">                    smtpsOutput.println(<span class="string">"MIME-Version: 1.0"</span>);</span><br><span class="line">                    smtpsOutput.flush();</span><br><span class="line">                    smtpsOutput.println(<span class="string">"Content-Type: text/plain;\n\tcharset=\"big5\""</span>);</span><br><span class="line">                    smtpsOutput.flush();</span><br><span class="line">                    smtpsOutput.println(<span class="string">"Content-Transfer-Encoding: 8bit"</span>);</span><br><span class="line">                    smtpsOutput.flush();</span><br><span class="line">                    smtpsOutput.print(<span class="string">"Subject:"</span>);  <span class="comment">// 標 題 </span></span><br><span class="line">                    smtpsOutput.write(subject.getBytes(<span class="string">"big5"</span>));</span><br><span class="line">                    smtpsOutput.println();</span><br><span class="line">                    smtpsOutput.flush();</span><br><span class="line">                    smtpsOutput.println();</span><br><span class="line">                    smtpsOutput.flush();</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i0 &amp;&amp; data[i].charAt(<span class="number">0</span>)==<span class="string">'.'</span>) &#123;</span><br><span class="line">                            smtpsOutput.write(<span class="string">'.'</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                        smtpsOutput.write(data[i].getBytes(<span class="string">"big5"</span>));</span><br><span class="line">                        smtpsOutput.println();</span><br><span class="line">                        smtpsOutput.flush();</span><br><span class="line">                    &#125;</span><br><span class="line">                    smtpsOutput.println(<span class="string">"."</span>);  <span class="comment">// 資料結束 </span></span><br><span class="line">                    smtpsOutput.flush();</span><br><span class="line">                    smtpsInput.readLine();</span><br><span class="line">                    smtpsOutput.println(<span class="string">"QUIT"</span>);  <span class="comment">// 斷線 </span></span><br><span class="line">                    smtpsOutput.close();</span><br><span class="line">                    smtpsInput.close();</span><br><span class="line">                    smtps.close();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125; <span class="keyword">catch</span>(Exception sendEx) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (queue.isFull()) &#123;</span><br><span class="line">                        System.out.println(<span class="string">"drop mail "</span>+sender+<span class="string">" "</span>+subject);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="HTTP-Server"><a href="#HTTP-Server" class="headerlink" title="HTTP Server"></a>HTTP Server</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * File:    HTTPServer.java</span></span><br><span class="line"><span class="comment"> * Author:  Shiuh-Sheng Yu</span></span><br><span class="line"><span class="comment"> *          Department of Information Management</span></span><br><span class="line"><span class="comment"> *          National ChiNan University</span></span><br><span class="line"><span class="comment"> * Purpose: A Simple HTTP Server Example</span></span><br><span class="line"><span class="comment"> * Update Date: 01/11/2000</span></span><br><span class="line"><span class="comment"> * Modified Date: 0206/2002</span></span><br><span class="line"><span class="comment"> * Modified Date: 2005/03/20,加入Cleaner Thread, 以避免Client要求準備檔案後,卻不擷取</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HTTPServer</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    Hashtable ht = <span class="keyword">new</span> Hashtable();</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Queue</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Socket[] data;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> head;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> tail;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Queue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            size = head = tail = <span class="number">0</span>;</span><br><span class="line">            data = <span class="keyword">new</span> Socket[<span class="number">100</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> Socket <span class="title">deQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">while</span> (size==<span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    wait();</span><br><span class="line">                &#125; <span class="keyword">catch</span>(Exception ex) &#123;&#125;;</span><br><span class="line">            &#125;</span><br><span class="line">            Socket tmp = data[head];</span><br><span class="line">            data[head] = <span class="keyword">null</span>;</span><br><span class="line">            head = (head+<span class="number">1</span>)%data.length;</span><br><span class="line">            size--;</span><br><span class="line">            <span class="keyword">if</span> (size==data.length-<span class="number">1</span>) &#123;</span><br><span class="line">                notifyAll();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> tmp;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">enQueue</span><span class="params">(Socket c)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">while</span> (size==data.length) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    wait();</span><br><span class="line">                &#125; <span class="keyword">catch</span>(Exception ex) &#123;&#125;;</span><br><span class="line">            &#125;</span><br><span class="line">            data[tail++] = c;</span><br><span class="line">            tail %= data.length;</span><br><span class="line">            size++;</span><br><span class="line">            <span class="keyword">if</span> (size==<span class="number">1</span>) &#123;</span><br><span class="line">                notifyAll();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Cleaner</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    sleep(<span class="number">60000</span>);</span><br><span class="line">                    <span class="keyword">long</span> currentTime = System.currentTimeMillis();</span><br><span class="line">                    <span class="keyword">for</span> (Enumeration e = HTTPServer.<span class="keyword">this</span>.ht.elements(); e.hasMoreElements(); ) &#123;</span><br><span class="line">                        CacheData tmp = (CacheData)e.nextElement();</span><br><span class="line">                        <span class="keyword">if</span> (tmp.time &lt; currentTime-<span class="number">30000</span>) &#123;</span><br><span class="line">                            HTTPServer.<span class="keyword">this</span>.ht.remove(tmp.fileName);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span>(InterruptedException epp) &#123;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">HTTPCon</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">        Queue queue;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">HTTPCon</span><span class="params">(Queue q)</span> </span>&#123;</span><br><span class="line">            queue = q;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            BufferedOutputStream out = <span class="keyword">null</span>;</span><br><span class="line">            BufferedReader in = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">for</span>(;;) &#123; <span class="comment">// loop forever to serve HTTP clients</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Socket s = queue.deQueue();</span><br><span class="line">                    out = <span class="keyword">new</span> BufferedOutputStream(s.getOutputStream());</span><br><span class="line">                    in = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(s.getInputStream()));</span><br><span class="line">                    String line;</span><br><span class="line">                    String whichFile=<span class="string">"/"</span>;</span><br><span class="line">                    <span class="keyword">while</span> ((line=in.readLine())!=<span class="keyword">null</span> &amp;&amp; !line.equals(<span class="string">""</span>)) &#123;</span><br><span class="line">                        <span class="comment">//System.out.println(line); // dump for debugging</span></span><br><span class="line">                        <span class="keyword">if</span> (line.startsWith(<span class="string">"GET"</span>)) &#123;</span><br><span class="line">                            <span class="comment">// StringTokenizer將字串以空白分開</span></span><br><span class="line">                            StringTokenizer st = <span class="keyword">new</span> StringTokenizer(line);</span><br><span class="line">                            st.nextToken();</span><br><span class="line">                            whichFile = st.nextToken();</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (whichFile.equals(<span class="string">"/"</span>)) &#123;</span><br><span class="line">                        whichFile = <span class="string">"/Welcome.html"</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// 過濾掉第一個 '/'</span></span><br><span class="line">                    whichFile = whichFile.substring(<span class="number">1</span>,whichFile.length());</span><br><span class="line">                    String fileType = <span class="string">"text/plain"</span>;</span><br><span class="line">                    <span class="keyword">if</span> (whichFile.endsWith(<span class="string">".html"</span>)) &#123;  <span class="comment">// HTML文字檔</span></span><br><span class="line">                        fileType = <span class="string">"text/html"</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (whichFile.endsWith(<span class="string">".txt"</span>)) &#123;  <span class="comment">// 文字檔</span></span><br><span class="line">                        fileType = <span class="string">"text/plain"</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (whichFile.endsWith(<span class="string">".jpg"</span>)) &#123; <span class="comment">// JPG圖檔</span></span><br><span class="line">                        fileType = <span class="string">"image/jpg"</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (whichFile.endsWith(<span class="string">".gif"</span>)) &#123; <span class="comment">// GIF圖檔</span></span><br><span class="line">                        fileType = <span class="string">"image/gif"</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// read from cache instead of file</span></span><br><span class="line">                    CacheData tmp;</span><br><span class="line">                    <span class="keyword">byte</span>[] data;</span><br><span class="line">                    <span class="keyword">if</span> ((tmp=((CacheData)HTTPServer.<span class="keyword">this</span>.ht.get(whichFile)))!=<span class="keyword">null</span>) &#123;</span><br><span class="line">                        data = tmp.data;</span><br><span class="line">                        HTTPServer.<span class="keyword">this</span>.ht.remove(whichFile); <span class="comment">// clear cache. Assume read once only</span></span><br><span class="line">                        out.write(<span class="string">"HTTP/1.0 200 OK\n"</span>.getBytes());</span><br><span class="line">                        out.write(<span class="string">"Connection: close\n"</span>.getBytes());</span><br><span class="line">                        out.write((<span class="string">"Content-Type: "</span>+fileType+<span class="string">"\n"</span>).getBytes());</span><br><span class="line">                        out.write((<span class="string">"Content-Length: "</span>+data.length+<span class="string">"\n\n"</span>).getBytes());</span><br><span class="line">                        out.write(data);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        out.write(<span class="string">"HTTP/1.0 404 找不到物件\n"</span>.getBytes());</span><br><span class="line">                        out.write(<span class="string">"Content-Type: text/html\n\n"</span>.getBytes());</span><br><span class="line">                        out.write(<span class="string">"&lt;html&gt;&lt;body&gt;&lt;h1&gt;HTTP/1.0 404 找不到物件 &lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;"</span>.getBytes());</span><br><span class="line">                    &#125;</span><br><span class="line">                    out.flush();</span><br><span class="line">                    in.close();</span><br><span class="line">                    out.close();</span><br><span class="line">                    s.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span>(Exception ex) &#123; <span class="comment">// fail to listen port</span></span><br><span class="line">                    <span class="comment">//System.out.println(ex);</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">CacheData</span> </span>&#123;</span><br><span class="line">        String fileName;</span><br><span class="line">        <span class="keyword">byte</span>[] data;</span><br><span class="line">        <span class="keyword">long</span> time;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">CacheData</span><span class="params">(String fileName, <span class="keyword">byte</span>[] data, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.fileName = fileName;</span><br><span class="line">            <span class="keyword">this</span>.data = data;</span><br><span class="line">            <span class="keyword">this</span>.time = time;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">put</span><span class="params">(String extension, <span class="keyword">byte</span>[] data)</span> </span>&#123;</span><br><span class="line">        String fileName;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            fileName = Integer.toString((<span class="keyword">int</span>)(Math.random()*<span class="number">1000000</span>))+extension;</span><br><span class="line">        &#125; <span class="keyword">while</span> (ht.get(fileName)!=<span class="keyword">null</span>);</span><br><span class="line">        ht.put(fileName, <span class="keyword">new</span> CacheData(fileName,data,System.currentTimeMillis()));</span><br><span class="line">        <span class="keyword">return</span> fileName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ServerSocket ss = <span class="keyword">new</span> ServerSocket(<span class="number">1999</span>);</span><br><span class="line">            Queue q = <span class="keyword">new</span> Queue();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;<span class="number">3</span>; i++) &#123;</span><br><span class="line">                (<span class="keyword">new</span> HTTPCon(q)).start();</span><br><span class="line">            &#125;</span><br><span class="line">            (<span class="keyword">new</span> Cleaner()).start();</span><br><span class="line">            <span class="keyword">for</span>(;;) &#123; <span class="comment">// loop forever to serve HTTP clients</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// 接收新的網路連線</span></span><br><span class="line">                    Socket s = ss.accept();</span><br><span class="line">                    s.setSoTimeout(<span class="number">5000</span>); <span class="comment">// 5秒內要讀到資料</span></span><br><span class="line">                    q.enQueue(s);</span><br><span class="line">                &#125; <span class="keyword">catch</span>(Exception ex2) &#123; <span class="comment">// fail to process Socket</span></span><br><span class="line">                    ex2.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span>(Exception ex) &#123; <span class="comment">// fail to listen port</span></span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        <div id="react-support-footer-root"></div>
      </div>
    </div>
  </div>
</div>

    


    

    <!-- js vendors -->
    <script src="//code.jquery.com/jquery-3.2.1.min.js" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/lunr.js/2.1.0/lunr.min.js"></script>

    <!-- js source  -->
    <script src="/script/doc.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

    

  </body>
</html>
