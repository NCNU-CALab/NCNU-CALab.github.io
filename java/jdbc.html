<!DOCTYPE html>
<html lang="zh">
  <head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">

    <title>SSYU 的書們 | JDBC </title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    

    <!-- fonts -->
    <link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700" rel="stylesheet">
    <link href="//fonts.googleapis.com/css?family=Ubuntu:300,400,500,600,700" rel="stylesheet">

    <!-- stylesheets -->
    <link rel="stylesheet" href="/style/doc.css">

    <!-- favicon -->
    <link rel="icon" href="/images/favicon.ico"><!-- hexo-inject:begin --><!-- hexo-inject:end -->

    

  </head>
  <body>

   <!-- hexo-inject:begin --><!-- hexo-inject:end --><script>window.__INITIAL_STATE__ = {"page":{"title":"JDBC","path":"java/jdbc.html"},"data":{"navigation":{"logo":{"text":"Programming Yu","type":"link","path":"index.html"},"main":[{"text":"C 程式語言教學","type":"label","children":[{"text":"程式寫作概論","type":"link","path":"c/writing-intro.html"},{"text":"電腦系統概論","type":"link","path":"c/system-intro.html"},{"text":"電腦內部運作","type":"link","path":"c/system-operation.html"},{"text":"C 語言的總覽","type":"link","path":"c/c-intro.html"}]},{"text":"C 程式語言範例","type":"label","children":[{}]},{"text":"Java 程式語言教學","type":"label","children":[{"text":"Java 與 C 的比較","type":"link","path":"java/java-vs-c.html"},{"text":"類別與物件","type":"link","path":"java/class-and-obj.html"},{"text":"陣列","type":"link","path":"java/array.html"},{"text":"封裝","type":"link","path":"java/encapsulation.html"},{"text":"訊息傳遞","type":"link","path":"java/message-passing.html"},{"text":"繼承","type":"link","path":"java/extends.html"},{"text":"介面","type":"link","path":"java/interface.html"},{"text":"例外處理","type":"link","path":"java/exception.html"},{"text":"線串與同步處理","type":"link","path":"java/thread.html"},{"text":"容器類別","type":"link","path":"java/container.html"},{"text":"GUI","type":"link","path":"java/gui.html"},{"text":"IO","type":"link","path":"java/io.html"},{"text":"NET","type":"link","path":"java/net.html"},{"text":"JDBC","type":"link","path":"java/jdbc.html"},{"text":"印表","type":"link","path":"java/easy-print.html"}]},{"text":"Java 程式語言範例","type":"label","children":[{"text":"所得稅計算","type":"link","path":"java/examples/tax-calculate.html"}]},{"text":"資料結構與演算法","type":"label"}]},"posts":[{"text":"The 3n + 1 problem","type":"link","path":"questions/The-3n-1-problem/","date":"2017-12-21T19:53:25+00:00"}]},"config":{"timezone":"Asia/Taipei","root":"/","time_format":"HH:mm:ss","theme":"doc","theme_config":{"swagger_ui":{"version":2,"permalinks":true,"api_explorer":true,"download":"Download specification","show_extensions":false,"deep_linking":true,"display_operation_id":false,"doc_expansion":"none"},"search":{"skip":false,"background":false,"route":"/lunr.json"},"favicon":"images/favicon.ico"}}}</script>

    <div id="react-navigation-root"><div class="doc-navigation" data-reactroot=""><nav class="doc-navbar"><a href="/index.html" class="doc-navbar__logo"><img src="/images/logo.png" class="doc-navbar__logo__img"/><span class="doc-navbar__logo__text">Programming Yu</span></a><i class="dc-icon dc-icon--close dc-icon--interactive doc-sidebar-close doc-navbar__sidebar-close doc-navbar__sidebar-close--desktop"></i><i class="dc-icon dc-icon--menu dc-icon--interactive doc-sidebar-toggle doc-navbar__sidebar-toggle"></i></nav><nav class="doc-sidebar"><div class="doc-sidebar__vertical-menu"><i class="dc-icon dc-icon--menu dc-icon--interactive doc-sidebar-toggle doc-sidebar-toggle--primary doc-sidebar__vertical-menu__item"></i><i class="dc-icon dc-icon--search dc-icon--interactive doc-sidebar__vertical-menu__item doc-sidebar__vertical-menu__item--primary"></i></div><div class="doc-sidebar-content"><div class="doc-sidebar__search-form"></div><ul class="doc-sidebar-list"></ul></div></nav></div></div>
    <div class="doc-content">
  <div class="dc-page">
    <div class="dc-card">
      <div id="react-search-results-root"></div>
      <div id="page-content" class="doc-formatting">
        <h1>JDBC</h1>
        <p>JDBC (Java DataBase Connectivity) 是 Java 程式用來連結資料庫的程式庫 <code>java.sql.*</code>。  </p>
<p>其中主要的類別有</p>
<ul>
<li>DriverManager：用來產生資料庫連線 (Connection)</li>
<li>Connection：用來產生下達命令給資料庫的敘述 (Statement, PreparedStatement 和 CallableStatement)</li>
<li>Statement：用來下達查詢 (<code>executeQuery()</code> 傳回 ResultSet) 和更新 (<code>executeUpdate()</code> 傳回整數代表異動的資料數目) 命令</li>
<li>ResultSet：利用其 <code>next()</code> 和 <code>getXXX()</code> 方法抓出查詢的結果</li>
<li>PreparedStatement：先送出命令的模板，然後再傳遞所需要的參數</li>
<li>CallableStatement：呼叫資料庫內的 Stored Procedure</li>
<li>DatabaseMetaData：用來查詢資料庫綱要</li>
</ul>
<p>下面的 <code>JDBCBridgeTest.java</code> 說明上面幾種 Class 的用法  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="keyword">import</span> ncnu.sql.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JDBCBridgeTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] argv)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName (<span class="string">"sun.jdbc.odbc.JdbcOdbcDriver"</span>);</span><br><span class="line">            String pass = <span class="string">"password"</span>;</span><br><span class="line">            String db = <span class="string">"jdbc:odbc:ncnu"</span>;</span><br><span class="line">            <span class="keyword">if</span> (argv.length&gt;<span class="number">0</span>) &#123;</span><br><span class="line">                pass = argv[<span class="number">0</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (argv.length&gt;<span class="number">1</span>) &#123;</span><br><span class="line">                db = argv[<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            Connection con = DriverManager.getConnection (db, <span class="string">"sa"</span>, pass);</span><br><span class="line">            con.setAutoCommit(<span class="keyword">true</span>);</span><br><span class="line">            PreparedStatement pstmt;</span><br><span class="line">            Statement stmt;</span><br><span class="line">            ResultSet rs;</span><br><span class="line">            stmt = con.createStatement();</span><br><span class="line">            <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">            rs = stmt.executeQuery(<span class="string">"select courseid,year,class,studentid from selected"</span>);</span><br><span class="line">            <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                count++;</span><br><span class="line">                rs.getBytes(<span class="number">1</span>);</span><br><span class="line">                rs.getBytes(<span class="number">2</span>);</span><br><span class="line">                rs.getBytes(<span class="number">3</span>);</span><br><span class="line">                rs.getBytes(<span class="number">4</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            rs.close();</span><br><span class="line">            System.out.println(<span class="string">"getBytes version for "</span>+count+<span class="string">" rows: "</span>+(System.currentTimeMillis()-start));</span><br><span class="line">            start = System.currentTimeMillis();</span><br><span class="line">            rs = stmt.executeQuery(<span class="string">"select courseid,year,class,studentid from selected"</span>);</span><br><span class="line">            <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                SQL.toString(rs.getBytes(<span class="number">1</span>));</span><br><span class="line">                SQL.toString(rs.getBytes(<span class="number">2</span>));</span><br><span class="line">                SQL.toString(rs.getBytes(<span class="number">3</span>));</span><br><span class="line">                SQL.toString(rs.getBytes(<span class="number">4</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            rs.close();</span><br><span class="line">            System.out.println(<span class="string">"SQL.toString version for "</span>+count+<span class="string">" rows: "</span>+(System.currentTimeMillis()-start));</span><br><span class="line">            start = System.currentTimeMillis();</span><br><span class="line">            rs = stmt.executeQuery(<span class="string">"select courseid,year,class,studentid from selected"</span>);</span><br><span class="line">            <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                rs.getString(<span class="number">1</span>);</span><br><span class="line">                rs.getString(<span class="number">2</span>);</span><br><span class="line">                rs.getString(<span class="number">3</span>);</span><br><span class="line">                rs.getString(<span class="number">4</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            rs.close();</span><br><span class="line">            System.out.println(<span class="string">"System getString version for "</span>+count+<span class="string">" rows: "</span>+(System.currentTimeMillis()-start));</span><br><span class="line">            stmt.executeUpdate(<span class="string">"delete printlog"</span>);</span><br><span class="line">            con.commit();</span><br><span class="line">            start = System.currentTimeMillis();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=<span class="number">10000</span>; i++) &#123;</span><br><span class="line">                stmt.executeUpdate(<span class="string">"insert printlog(printid,studentid,class,type,copy,year,email,success,ip,price) values("</span>+i+<span class="string">",'90213001','B','中文歷年成績單',1,'901','ssyu@ncnu.edu.tw','Y','163.22.22.22',20)"</span>);</span><br><span class="line">                con.commit();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">"Statement insert 10000 rows: "</span>+(System.currentTimeMillis()-start));</span><br><span class="line">            start = System.currentTimeMillis();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=<span class="number">10000</span>; i++) &#123;</span><br><span class="line">                stmt.executeUpdate(<span class="string">"delete printlog where printid="</span>+i);</span><br><span class="line">                con.commit();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">"Statement delete 10000 rows: "</span>+(System.currentTimeMillis()-start));</span><br><span class="line">            stmt.close();</span><br><span class="line">            start = System.currentTimeMillis();</span><br><span class="line">            pstmt = con.prepareStatement(<span class="string">"insert printlog(printid,studentid,class,type,copy,year,email,success,ip,price) values(?,?,?,?,?,?,?,?,?,?)"</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">10000</span>; i++) &#123;</span><br><span class="line">                pstmt.setInt(<span class="number">1</span>,i);</span><br><span class="line">                pstmt.setString(<span class="number">2</span>,<span class="string">"90213001"</span>);</span><br><span class="line">                pstmt.setString(<span class="number">3</span>,<span class="string">"B"</span>);</span><br><span class="line">                pstmt.setString(<span class="number">4</span>,<span class="string">"中文歷年成績單"</span>);</span><br><span class="line">                pstmt.setInt(<span class="number">5</span>,<span class="number">3</span>);</span><br><span class="line">                pstmt.setString(<span class="number">6</span>,<span class="string">"901"</span>);</span><br><span class="line">                pstmt.setString(<span class="number">7</span>,<span class="string">"ssyu@ncnu.edu.tw"</span>);</span><br><span class="line">                pstmt.setString(<span class="number">8</span>,<span class="string">"Y"</span>);</span><br><span class="line">                pstmt.setString(<span class="number">9</span>,<span class="string">"163.22.22.22"</span>);</span><br><span class="line">                pstmt.setInt(<span class="number">10</span>,<span class="number">20</span>);</span><br><span class="line">                pstmt.executeUpdate();</span><br><span class="line">                con.commit();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">"PreparedStatement version1 insert 10000 rows: "</span>+(System.currentTimeMillis()-start));</span><br><span class="line">            pstmt.close();</span><br><span class="line">            start = System.currentTimeMillis();</span><br><span class="line">            pstmt = con.prepareStatement(<span class="string">"delete printlog where printid=?"</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=<span class="number">10000</span>; i++) &#123;</span><br><span class="line">                pstmt.setInt(<span class="number">1</span>,i);</span><br><span class="line">                pstmt.executeUpdate();</span><br><span class="line">                con.commit();</span><br><span class="line">            &#125;</span><br><span class="line">            pstmt.close();</span><br><span class="line">            System.out.println(<span class="string">"PrepareStatement delete 10000 rows: "</span>+(System.currentTimeMillis()-start));</span><br><span class="line">            start = System.currentTimeMillis();</span><br><span class="line">            pstmt = con.prepareStatement(<span class="string">"insert printlog(printid,studentid,class,type,copy,year,email,success,ip,price) values(?,?,?,?,?,?,?,?,?,?)"</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">10000</span>; i++) &#123;</span><br><span class="line">                pstmt.setInt(<span class="number">1</span>,i);</span><br><span class="line">                pstmt.setBytes(<span class="number">2</span>,SQL.toAscii(<span class="string">"90213001"</span>));</span><br><span class="line">                pstmt.setBytes(<span class="number">3</span>,SQL.toAscii(<span class="string">"B"</span>));</span><br><span class="line">                pstmt.setBytes(<span class="number">4</span>,SQL.toAscii(<span class="string">"中文歷年成績單"</span>));</span><br><span class="line">                pstmt.setInt(<span class="number">5</span>,<span class="number">3</span>);</span><br><span class="line">                pstmt.setBytes(<span class="number">6</span>,SQL.toAscii(<span class="string">"901"</span>));</span><br><span class="line">                pstmt.setBytes(<span class="number">7</span>,SQL.toAscii(<span class="string">"ssyu@ncnu.edu.tw"</span>));</span><br><span class="line">                pstmt.setBytes(<span class="number">8</span>,SQL.toAscii(<span class="string">"N"</span>));</span><br><span class="line">                pstmt.setBytes(<span class="number">9</span>,SQL.toAscii(<span class="string">"163.22.22.22"</span>));</span><br><span class="line">                pstmt.setInt(<span class="number">10</span>,<span class="number">20</span>);</span><br><span class="line">                pstmt.executeUpdate();</span><br><span class="line">                con.commit();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">"PreparedStatement version2 insert 10000 rows: "</span>+(System.currentTimeMillis()-start));</span><br><span class="line">            pstmt.close();</span><br><span class="line">            stmt = con.createStatement();</span><br><span class="line">            stmt.executeUpdate(<span class="string">"delete printlog"</span>);</span><br><span class="line">            stmt.close();</span><br><span class="line">            con.close();</span><br><span class="line">       &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">            System.exit(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>SQL.java</code> 的 Source Code 如下  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> ncnu.sql;</span><br><span class="line"><span class="keyword">import</span> sun.io.*;</span><br><span class="line"><span class="keyword">import</span> ncnu.rule.Environment;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The class is used to work around a bug in JDBC drivers. The driver truncate the leading</span></span><br><span class="line"><span class="comment"> * byte of Unicode character before sending to DBMS. This only works for ASCII character.</span></span><br><span class="line"><span class="comment"> * To handle strings to DBMS, you have to use SQL.toSQL() to wrap the output</span></span><br><span class="line"><span class="comment"> * string. JDBC drivers also treat the data from DBMS as ASCII code by adding 0 before every</span></span><br><span class="line"><span class="comment"> * bytes of the incoming data. This also produce errors for Non-ASCII characters. To work</span></span><br><span class="line"><span class="comment"> * around this bug, you have to wrap the incoming data with SQL.fromSQL()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SQL</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> ByteToCharConverter toChar;</span><br><span class="line">    <span class="keyword">static</span> CharToByteConverter toByte;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">boolean</span> trans = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (System.getProperty(<span class="string">"java.version"</span>).startsWith(<span class="string">"1.1"</span>)) &#123;</span><br><span class="line">                trans = <span class="keyword">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                trans = <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            String encoding = <span class="string">"Big5"</span>;</span><br><span class="line">            String domain = Environment.getDomain();</span><br><span class="line">            <span class="keyword">if</span> (domain.endsWith(<span class="string">".tw"</span>)) &#123;</span><br><span class="line">                encoding = <span class="string">"Big5"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            SQL.toChar = ByteToCharConverter.getConverter(encoding);</span><br><span class="line">            SQL.toByte = CharToByteConverter.getConverter(encoding);</span><br><span class="line">        &#125; <span class="keyword">catch</span>(Exception ex) &#123;</span><br><span class="line">            ex.printStackTrace();</span><br><span class="line">            System.exit(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setEncoding</span><span class="params">(String encoding)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            SQL.toChar = ByteToCharConverter.getConverter(encoding);</span><br><span class="line">            SQL.toByte = CharToByteConverter.getConverter(encoding);</span><br><span class="line">        &#125; <span class="keyword">catch</span>(Exception ex) &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * convert a string to ASCII byte array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] toAscii(String s) &#123;</span><br><span class="line">        <span class="keyword">if</span> (s==<span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">synchronized</span>(toByte) &#123;</span><br><span class="line">                <span class="keyword">return</span> toByte.convertAll(s.toCharArray());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span>(Exception ex) &#123;</span><br><span class="line">            System.out.println(ex);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">char</span>[] toChars(<span class="keyword">byte</span>[] data) &#123;</span><br><span class="line">        <span class="keyword">if</span> (data==<span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">synchronized</span>(toChar) &#123;</span><br><span class="line">                <span class="keyword">return</span> toChar.convertAll(data);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span>(Exception ex) &#123;</span><br><span class="line">            System.out.println(ex);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">toStringFast</span><span class="params">(<span class="keyword">byte</span>[] data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (data==<span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">char</span>[] tmp = <span class="keyword">new</span> <span class="keyword">char</span>[data.length];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;data.length; i++) &#123;</span><br><span class="line">            tmp[i] = (<span class="keyword">char</span>)data[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> String(tmp);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">quote</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (s.indexOf(<span class="string">"'"</span>)&lt;<span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> s;</span><br><span class="line">        &#125;</span><br><span class="line">        StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;s.length(); i++) &#123;</span><br><span class="line">            <span class="keyword">char</span> c = s.charAt(i);</span><br><span class="line">            sb.append(c);</span><br><span class="line">            <span class="keyword">if</span> (c==<span class="string">'\''</span>) &#123;</span><br><span class="line">                sb.append(c);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">toString</span><span class="params">(<span class="keyword">byte</span>[] data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (data==<span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">synchronized</span>(toChar) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> String(toChar.convertAll(data));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span>(Exception ex) &#123;</span><br><span class="line">            System.out.println(ex);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Convert a string for output to DBMS</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> s The string needs to be converted.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> A string which will be truncated by JDBC to produce Big5 characters.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">toSQL</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (s==<span class="keyword">null</span>) <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">if</span> (!trans) <span class="keyword">return</span> s;</span><br><span class="line">        <span class="keyword">byte</span>[] orig;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">synchronized</span>(toChar) &#123;</span><br><span class="line">                orig = toByte.convertAll(s.toCharArray());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">char</span>[] dest = <span class="keyword">new</span> <span class="keyword">char</span>[orig.length];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; orig.length; i++)</span><br><span class="line">                dest[i] = (<span class="keyword">char</span>)orig[i];</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> String(dest);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> s;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Convert an incorrect string produeced by JDBC drivers to correct Unicode string.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> s The string needs to be converted.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> A correct Unicode string.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">fromSQL</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i, j;</span><br><span class="line">        <span class="keyword">if</span> (s==<span class="keyword">null</span>) <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">if</span> (!trans) <span class="keyword">return</span> s;</span><br><span class="line">        <span class="keyword">char</span>[] orig = s.toCharArray();</span><br><span class="line">        <span class="keyword">byte</span>[] dest = <span class="keyword">new</span> <span class="keyword">byte</span>[orig.length];</span><br><span class="line">        <span class="keyword">for</span> (i=<span class="number">0</span>; i &lt; orig.length; i++)</span><br><span class="line">            dest[i] = (<span class="keyword">byte</span>) orig[i];</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">synchronized</span>(toChar) &#123;</span><br><span class="line">                <span class="keyword">char</span>[] tmp = toChar.convertAll(dest);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> String(tmp);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> s;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="查詢資料庫綱要"><a href="#查詢資料庫綱要" class="headerlink" title="查詢資料庫綱要"></a>查詢資料庫綱要</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> ncnu.sql;</span><br><span class="line"><span class="comment">/* Program Name: Schema.java</span></span><br><span class="line"><span class="comment">   Subject: 資料綱要讀取程式 </span></span><br><span class="line"><span class="comment">   Author: 俞旭昇 Shiuh-Sheng Yu</span></span><br><span class="line"><span class="comment">           National ChiNan University</span></span><br><span class="line"><span class="comment">           Department of Information Management </span></span><br><span class="line"><span class="comment">   Edit Date: 01/10/2000</span></span><br><span class="line"><span class="comment">   Last Update Date: 01/10/2000</span></span><br><span class="line"><span class="comment">   ToolKit: JDK1.1</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Schema</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    Vector tables=<span class="keyword">null</span>;</span><br><span class="line">    String catalogSeparator=<span class="keyword">null</span>, catalog, schema;</span><br><span class="line">    Schema (Connection con, String catalog, String schema) &#123;</span><br><span class="line">        <span class="keyword">this</span>.catalog = catalog;</span><br><span class="line">        <span class="keyword">this</span>.schema = schema;</span><br><span class="line">        tables = <span class="keyword">new</span> Vector();</span><br><span class="line">        ForeignKey fk;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ResultSet rs;</span><br><span class="line">            DatabaseMetaData md = con.getMetaData();</span><br><span class="line">            catalogSeparator = md.getCatalogSeparator();</span><br><span class="line">            String[] types = <span class="keyword">new</span> String[<span class="number">1</span>];</span><br><span class="line">            types[<span class="number">0</span>] = <span class="string">"TABLE"</span>;</span><br><span class="line">            <span class="comment">// get all user defined tables</span></span><br><span class="line">            rs = md.getTables(catalog,schema,<span class="keyword">null</span>,types);</span><br><span class="line">            <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                Table table = <span class="keyword">new</span> Table();</span><br><span class="line">                tables.addElement(table);</span><br><span class="line">                table.catalogName = rs.getString(<span class="number">1</span>);</span><br><span class="line">                table.schemaName = rs.getString(<span class="number">2</span>);</span><br><span class="line">                table.tableName = rs.getString(<span class="number">3</span>);</span><br><span class="line">                table.totalName = getTotalName(table.catalogName,table.schemaName,table.tableName);</span><br><span class="line">                table.tableType = rs.getString(<span class="number">4</span>);</span><br><span class="line">                table.remarks = rs.getString(<span class="number">5</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            rs.close();</span><br><span class="line">            <span class="comment">// get all columns</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; tables.size(); i++) &#123;</span><br><span class="line">                Table check = (Table)tables.elementAt(i);</span><br><span class="line">                rs = md.getColumns(check.catalogName, check.schemaName,check.tableName,<span class="keyword">null</span>);</span><br><span class="line">                <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                    Column col = <span class="keyword">new</span> Column();</span><br><span class="line">                    col.tableName = check.totalName;</span><br><span class="line">                    col.columnName = rs.getString(<span class="number">4</span>).trim();</span><br><span class="line">                    col.dataType = rs.getInt(<span class="number">5</span>);</span><br><span class="line">                    col.typeName = rs.getString(<span class="number">6</span>).trim();</span><br><span class="line">                    col.columnSize = rs.getInt(<span class="number">7</span>);</span><br><span class="line">                    col.decimalDigits = rs.getInt(<span class="number">9</span>);</span><br><span class="line">                    col.radix = rs.getInt(<span class="number">10</span>);</span><br><span class="line">                    col.remarks = SQL.fromSQL(rs.getString(<span class="number">12</span>));</span><br><span class="line">                    col.columnDefault = SQL.fromSQL(rs.getString(<span class="number">13</span>)).trim();</span><br><span class="line">                    <span class="keyword">while</span> (col.columnDefault.startsWith(<span class="string">"'"</span>) || col.columnDefault.startsWith(<span class="string">"("</span>)) &#123;</span><br><span class="line">                        col.columnDefault = col.columnDefault.substring(<span class="number">1</span>,col.columnDefault.length());</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">while</span> (col.columnDefault.endsWith(<span class="string">"'"</span>) || col.columnDefault.endsWith(<span class="string">")"</span>)) &#123;</span><br><span class="line">                        col.columnDefault = col.columnDefault.substring(<span class="number">0</span>,col.columnDefault.length()-<span class="number">1</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    col.isNullable = SQL.toString(rs.getBytes(<span class="number">18</span>)).trim();</span><br><span class="line">                    <span class="keyword">if</span> (col.remarks==<span class="keyword">null</span> || col.remarks.equals(<span class="string">""</span>)) &#123;</span><br><span class="line">                        col.remarks=col.columnName;</span><br><span class="line">                    &#125;</span><br><span class="line">                    check.addColumn(col);</span><br><span class="line">                &#125;</span><br><span class="line">                rs.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// get Primary key</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; tables.size(); i++) &#123;</span><br><span class="line">                Table check = (Table)tables.elementAt(i);</span><br><span class="line">                rs = md.getPrimaryKeys(check.catalogName, check.schemaName,check.tableName);</span><br><span class="line">                <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                    check.primaryKey.addElement(findColumn(check,rs.getString(<span class="number">4</span>)));</span><br><span class="line">                &#125;</span><br><span class="line">                rs.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// get Foreign Keys</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; tables.size(); i++) &#123;</span><br><span class="line">                Table check = (Table)tables.elementAt(i);</span><br><span class="line">                rs = md.getImportedKeys(check.catalogName, check.schemaName,check.tableName);</span><br><span class="line">                fk = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                    String tmp1 = rs.getString(<span class="number">1</span>); <span class="comment">// remote primary catalog</span></span><br><span class="line">                    String tmp2 = rs.getString(<span class="number">2</span>); <span class="comment">// remote primary schema</span></span><br><span class="line">                    String tmp3 = rs.getString(<span class="number">3</span>); <span class="comment">// remote primary table</span></span><br><span class="line">                    String tmp4 = rs.getString(<span class="number">4</span>); <span class="comment">// remote primary column</span></span><br><span class="line">                    String tmp8 = rs.getString(<span class="number">8</span>); <span class="comment">// local foreign column</span></span><br><span class="line">                    <span class="keyword">int</span> tmp9 = rs.getInt(<span class="number">9</span>);</span><br><span class="line">                    <span class="keyword">if</span> (tmp9 == <span class="number">1</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (fk != <span class="keyword">null</span>) &#123;</span><br><span class="line">                            check.addForeignKey(fk);</span><br><span class="line">                        &#125;</span><br><span class="line">                        fk = <span class="keyword">new</span> ForeignKey();</span><br><span class="line">                    &#125;</span><br><span class="line">                    fk.primaryTable = findTable(tmp1,tmp2,tmp3);</span><br><span class="line">                    fk.foreignTable = check;</span><br><span class="line">                    fk.primary.addElement(findColumn(tmp1,tmp2,tmp3,tmp4));</span><br><span class="line">                    fk.foreign.addElement(findColumn(check,tmp8));</span><br><span class="line">                &#125;</span><br><span class="line">                rs.close();</span><br><span class="line">                <span class="keyword">if</span> (fk != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    check.addForeignKey(fk);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// get Reference By</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; tables.size(); i++) &#123;</span><br><span class="line">                Table check = (Table)tables.elementAt(i);</span><br><span class="line">                rs = md.getExportedKeys(check.catalogName, check.schemaName,check.tableName);</span><br><span class="line">                fk = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                    String tmp4 = rs.getString(<span class="number">4</span>); <span class="comment">// local primary column</span></span><br><span class="line">                    String tmp5 = rs.getString(<span class="number">5</span>); <span class="comment">// remote foreign catalog</span></span><br><span class="line">                    String tmp6 = rs.getString(<span class="number">6</span>); <span class="comment">// remote foreign schema</span></span><br><span class="line">                    String tmp7 = rs.getString(<span class="number">7</span>); <span class="comment">// remote foreign table</span></span><br><span class="line">                    String tmp8 = rs.getString(<span class="number">8</span>); <span class="comment">// remote foreign column</span></span><br><span class="line">                    <span class="keyword">int</span> tmp9 = rs.getInt(<span class="number">9</span>);</span><br><span class="line">                    <span class="keyword">if</span> (tmp9 == <span class="number">1</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (fk != <span class="keyword">null</span>) &#123;</span><br><span class="line">                            check.addReferenceBy(fk);</span><br><span class="line">                        &#125;</span><br><span class="line">                        fk = <span class="keyword">new</span> ForeignKey();</span><br><span class="line">                    &#125;</span><br><span class="line">                    fk.primaryTable = check;</span><br><span class="line">                    fk.foreignTable = findTable(tmp5,tmp6,tmp7);</span><br><span class="line">                    fk.primary.addElement(findColumn(check,tmp4));</span><br><span class="line">                    fk.foreign.addElement(findColumn(tmp5,tmp6,tmp7,tmp8));</span><br><span class="line">                &#125;</span><br><span class="line">                rs.close();</span><br><span class="line">                <span class="keyword">if</span> (fk != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    check.addReferenceBy(fk);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException ex) &#123;</span><br><span class="line">            ShowSQLException.show(ex);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">               con.commit();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e2) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Table <span class="title">findTable</span><span class="params">(String catalog, String schema, String table)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> findTable(getTotalName(catalog, schema, table));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Table <span class="title">findTable</span><span class="params">(String totalName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i, j;</span><br><span class="line">        <span class="keyword">for</span> (i=j=<span class="number">0</span>; totalName.indexOf(catalogSeparator,i) != -<span class="number">1</span>; j++) &#123;</span><br><span class="line">            i = totalName.indexOf(catalogSeparator,i) + catalogSeparator.length();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// How many full name still need to fill? eg student.name ==&gt; ncnu.dbo.student.name</span></span><br><span class="line">        <span class="keyword">if</span> (j==<span class="number">0</span>) &#123; <span class="comment">// we miss all</span></span><br><span class="line">            totalName = catalog+catalogSeparator+schema+catalogSeparator+totalName;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (j==<span class="number">1</span>) &#123; <span class="comment">// we miss catalogName</span></span><br><span class="line">            totalName = catalog+catalogSeparator+totalName;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// we have all</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (i=<span class="number">0</span>; i &lt; tables.size(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (((Table)tables.elementAt(i)).totalName.equals(totalName)) &#123;</span><br><span class="line">                <span class="keyword">return</span> (Table)tables.elementAt(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Column <span class="title">findColumn</span><span class="params">(String totalName, String columnName)</span> </span>&#123;</span><br><span class="line">        Table t = findTable(totalName);</span><br><span class="line">        <span class="keyword">if</span> (t == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> findColumn(t, columnName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Column <span class="title">findColumn</span><span class="params">(String catalog, String schema, String table, String column)</span> </span>&#123;</span><br><span class="line">        Table t = findTable(catalog, schema, table);</span><br><span class="line">        <span class="keyword">if</span> (t == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> findColumn(t, column);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Column <span class="title">findColumn</span><span class="params">(Table t, String column)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; t.columns.size(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (((Column)t.columns.elementAt(i)).columnName.equals(column)) &#123;</span><br><span class="line">                <span class="keyword">return</span> (Column)t.columns.elementAt(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTotalName</span><span class="params">(String catalog, String schema, String table)</span> </span>&#123;</span><br><span class="line">        String totalName = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">if</span> (catalog!=<span class="keyword">null</span> &amp;&amp; catalog.trim().length()&gt;<span class="number">0</span>) &#123;</span><br><span class="line">            totalName = catalog.trim()+catalogSeparator;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (schema!=<span class="keyword">null</span> &amp;&amp; schema.trim().length()&gt;<span class="number">0</span>) &#123;</span><br><span class="line">            totalName += schema.trim()+catalogSeparator;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (table!=<span class="keyword">null</span> &amp;&amp; table.trim().length()&gt;<span class="number">0</span>) &#123;</span><br><span class="line">            totalName += table.trim();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> totalName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCatalogSeparator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> catalogSeparator;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Vector <span class="title">getTables</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> tables;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Table.java</code> 如下  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> ncnu.sql;</span><br><span class="line"><span class="comment">/* Program Name: Table.java</span></span><br><span class="line"><span class="comment">   Subject: 定義資料表格的屬性 </span></span><br><span class="line"><span class="comment">   CopyRight: 俞旭昇 Shiuh-Sheng Yu</span></span><br><span class="line"><span class="comment">           National Chi-Nan University</span></span><br><span class="line"><span class="comment">           Institute of Management Information </span></span><br><span class="line"><span class="comment">   Edit Date: 01/03/1998</span></span><br><span class="line"><span class="comment">   Last Update Date: 01/04/1997</span></span><br><span class="line"><span class="comment">   ToolKit: JDK1.1.5</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Table</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    String catalogName;</span><br><span class="line">    String schemaName;</span><br><span class="line">    String tableName;</span><br><span class="line">    String totalName;</span><br><span class="line">    String tableType;</span><br><span class="line">    String remarks;</span><br><span class="line">    Vector columns;</span><br><span class="line">    Vector primaryKey;</span><br><span class="line">    Vector foreignKeys;</span><br><span class="line">    Vector referenceBy;</span><br><span class="line">    Table() &#123;</span><br><span class="line">        columns = <span class="keyword">new</span> Vector();</span><br><span class="line">        foreignKeys = <span class="keyword">new</span> Vector();</span><br><span class="line">        primaryKey = <span class="keyword">new</span> Vector();</span><br><span class="line">        referenceBy = <span class="keyword">new</span> Vector();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addColumn</span><span class="params">(Column c)</span> </span>&#123;</span><br><span class="line">        columns.addElement(c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Column <span class="title">getColumn</span><span class="params">(String cname)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; columns.size(); i++) &#123;</span><br><span class="line">            Column c = (Column)columns.elementAt(i);</span><br><span class="line">            <span class="keyword">if</span> (c.columnName.equalsIgnoreCase(cname)) &#123;</span><br><span class="line">                <span class="keyword">return</span> c;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addForeignKey</span><span class="params">(ForeignKey fk)</span> </span>&#123;</span><br><span class="line">        foreignKeys.addElement(fk);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">removeForeignKey</span><span class="params">(Table t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; foreignKeys.size(); i++) &#123;</span><br><span class="line">            ForeignKey fk = (ForeignKey)foreignKeys.elementAt(i);</span><br><span class="line">            <span class="keyword">if</span> (fk.primaryTable==t) &#123;</span><br><span class="line">                foreignKeys.removeElementAt(i);</span><br><span class="line">                i--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addReferenceBy</span><span class="params">(ForeignKey fk)</span> </span>&#123;</span><br><span class="line">        referenceBy.addElement(fk);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Table: "</span>+catalogName+<span class="string">"."</span>+schemaName+<span class="string">"."</span>+tableName);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; columns.size(); i++) &#123;</span><br><span class="line">            ((Column)columns.elementAt(i)).print();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (primaryKey != <span class="keyword">null</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">"PrimaryKey:"</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; primaryKey.size(); i++) &#123;</span><br><span class="line">                ((Column)primaryKey.elementAt(i)).print();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (foreignKeys != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; foreignKeys.size(); i++) &#123;</span><br><span class="line">                System.out.println(<span class="string">"ForeignKey:"</span>);</span><br><span class="line">                ((ForeignKey)foreignKeys.elementAt(i)).print();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (referenceBy != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; referenceBy.size(); i++) &#123;</span><br><span class="line">                System.out.println(<span class="string">"Reference By:"</span>);</span><br><span class="line">                ((ForeignKey)referenceBy.elementAt(i)).print();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>ForeignKey.java</code> 如下  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> ncnu.sql;</span><br><span class="line"><span class="comment">/* Program Name: ForeignKey.java</span></span><br><span class="line"><span class="comment">   Subject: Foreign Key, used bye View.java </span></span><br><span class="line"><span class="comment">   CopyRight: 俞旭昇 Shiuh-Sheng Yu</span></span><br><span class="line"><span class="comment">           National ChiNan University</span></span><br><span class="line"><span class="comment">           Department of Information Management </span></span><br><span class="line"><span class="comment">   Edit Date: 01/03/1998</span></span><br><span class="line"><span class="comment">   Last Update Date: 08/21/1998</span></span><br><span class="line"><span class="comment">   ToolKit: JDK1.1.6</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">import</span> java.util.Vector;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ForeignKey</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    Table primaryTable;</span><br><span class="line">    Table foreignTable;</span><br><span class="line">    Vector primary; <span class="comment">// vector of Columns</span></span><br><span class="line">    Vector foreign; <span class="comment">// vecotr of Columns</span></span><br><span class="line">    ForeignKey() &#123;</span><br><span class="line">        primary = <span class="keyword">new</span> Vector();</span><br><span class="line">        foreign = <span class="keyword">new</span> Vector();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">String <span class="title">getJoinCondition</span><span class="params">(String sep)</span> </span>&#123;</span><br><span class="line">        String cond = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; primary.size(); i++) &#123;</span><br><span class="line">            Column x = (Column)primary.elementAt(i);</span><br><span class="line">            Column y = (Column)foreign.elementAt(i);</span><br><span class="line">            cond += x.tableName+sep+x.columnName+<span class="string">"="</span>+y.tableName+sep+y.columnName+<span class="string">" and "</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cond;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"ForeignKey:"</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;primary.size(); i++) &#123;</span><br><span class="line">            ((Column)primary.elementAt(i)).print();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"references"</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;foreign.size(); i++) &#123;</span><br><span class="line">            ((Column)foreign.elementAt(i)).print();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Column.java</code> 如下  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> ncnu.sql;</span><br><span class="line"><span class="comment">/* Program Name: Column.java</span></span><br><span class="line"><span class="comment">   Subject: 定義資料欄位的屬性 </span></span><br><span class="line"><span class="comment">   CopyRight: 俞旭昇 Shiuh-Sheng Yu</span></span><br><span class="line"><span class="comment">           National Chi-Nan University</span></span><br><span class="line"><span class="comment">           Institute of Management Information </span></span><br><span class="line"><span class="comment">   Edit Date: 01/03/1998</span></span><br><span class="line"><span class="comment">   Last Update Date: 01/04/1997</span></span><br><span class="line"><span class="comment">   ToolKit: JDK1.1.5</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.sql.Types;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Column</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    String tableName;</span><br><span class="line">    String columnName;</span><br><span class="line">    String typeName;</span><br><span class="line">    <span class="keyword">int</span> dataType;</span><br><span class="line">    <span class="keyword">int</span> columnSize;</span><br><span class="line">    <span class="keyword">int</span> decimalDigits;</span><br><span class="line">    <span class="keyword">int</span> radix;</span><br><span class="line">    String isNullable;</span><br><span class="line">    String remarks;</span><br><span class="line">    String columnDefault;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isNumeric</span><span class="params">(<span class="keyword">int</span> type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">            <span class="keyword">case</span> Types.BIGINT:</span><br><span class="line">            <span class="keyword">case</span> Types.TINYINT:</span><br><span class="line">            <span class="keyword">case</span> Types.SMALLINT:</span><br><span class="line">            <span class="keyword">case</span> Types.NUMERIC:</span><br><span class="line">            <span class="keyword">case</span> Types.DECIMAL:</span><br><span class="line">            <span class="keyword">case</span> Types.FLOAT:</span><br><span class="line">            <span class="keyword">case</span> Types.INTEGER:</span><br><span class="line">            <span class="keyword">case</span> Types.REAL:</span><br><span class="line">            <span class="keyword">case</span> Types.DOUBLE:</span><br><span class="line">            <span class="keyword">case</span> Types.BIT:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.print(tableName+<span class="string">"."</span>+columnName+<span class="string">" "</span>+typeName+<span class="string">" "</span>+columnSize+<span class="string">" "</span>);</span><br><span class="line">        <span class="keyword">if</span> (typeName.equals(<span class="string">"numeric"</span>)) &#123;</span><br><span class="line">            System.out.print(<span class="string">"decimal:"</span>+decimalDigits+<span class="string">" radix:"</span>+radix+<span class="string">" "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(isNullable+<span class="string">" "</span>+remarks+<span class="string">" default:"</span>+columnDefault);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        <div id="react-support-footer-root"></div>
      </div>
    </div>
  </div>
</div>

    


    

    <!-- js vendors -->
    <script src="//code.jquery.com/jquery-3.2.1.min.js" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/lunr.js/2.1.0/lunr.min.js"></script>

    <!-- js source  -->
    <script src="/script/doc.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

    

  </body>
</html>
